<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas
	xmlns:mx="http://www.adobe.com/2006/mxml"
	initialize="onInitialize()"
	fontSize="12"
	>
	<mx:Script>
		<![CDATA[
			import flash.utils.setTimeout;
			import socialfaceicon.view.DesktopWindow;
			import socialfaceicon.model.TwitUser;
			import socialfaceicon.model.threads.UpdateTwitFriendsThread;
			import socialfaceicon.model.TwitSession;
			import socialfaceicon.model.TwitFriend;
			import socialfaceicon.model.Setting;
			
			[Bindable]
			private var twitterDataList:Array;
			
			private function onInitialize():void {
				loadingLabel.visible = false;
				var username:String = Setting.twitterUsername;
				var password:String = Setting.twitterPassword;
				if (username) {
					twitterUsernameTextInput.text = username;
					twitterPasswordTextInput.text = password || "";
					//setTimeout(showTwitterFriends, 100);
					showTwitterFriends();
				}
			}
			
			private function onTwitterLoginButtonClick():void {
				twitterDataList = [];
				Setting.twitterUsername = twitterUsernameTextInput.text;
				Setting.twitterPassword = twitterPasswordTextInput.text;
				TwitSession.start(
						Setting.twitterUsername,
						Setting.twitterPassword);
				var t:UpdateTwitFriendsThread =
						new UpdateTwitFriendsThread(Setting.twitterUsername);
				t.addEventListener(
					UpdateTwitFriendsThread.FINISH,
					function():void {
						loadingTwitterFriends = false;
						showTwitterFriends();
					});
				t.start();
				
				loadingTwitterFriends = true;
				//status = "Now Loading Twitter Friends. It takes several minutes.";
			}
			
			private function set loadingTwitterFriends(value:Boolean):void {
				twitterLoginButton.enabled = !value;
				loadingLabel.visible = value;
			}
			
			private function showTwitterFriends():void {
				var users:Array = TwitFriend.getUsers( TwitSession.username );
				if (users && users.length) {
					twitterDataList = users;
					//showDraggableStatus();
				}
			}
			
			private function showDraggableStatus():void {
				//status = "Drag icons onto the Desktop";
			}
			
			//
			// Drag & Drop
			//
			private function onDragStart():void {
				DesktopWindow.instance.show();
			}
			
			private function onDragComplete():void {
				DesktopWindow.instance.hide();
			}
		]]>
	</mx:Script>
	<mx:VBox width="100%" height="100%" verticalGap="10">
		<mx:Grid paddingLeft="10">
			<mx:GridRow width="100%" height="100%">
				<mx:GridItem width="100%" height="100%">
					<mx:Label text="Username" fontWeight="normal"/>
				</mx:GridItem>
				<mx:GridItem width="100%" height="100%">
					<mx:Label text="Password" fontWeight="normal"/>
				</mx:GridItem>
				<mx:GridItem width="100%" height="100%">
				</mx:GridItem>
			</mx:GridRow>
			<mx:GridRow width="100%" height="100%">
				<mx:GridItem width="100%" height="100%">
					<mx:TextInput width="100" id="twitterUsernameTextInput"/>
				</mx:GridItem>
				<mx:GridItem width="100%" height="100%">
					<mx:TextInput width="100" displayAsPassword="true" id="twitterPasswordTextInput"/>
				</mx:GridItem>
				<mx:GridItem width="100%" height="100%" verticalAlign="middle">
					<mx:Button
						 label="Login"
						 click="onTwitterLoginButtonClick()"
						 id="twitterLoginButton"/>
					<mx:Label text="Loading Friends..." fontWeight="bold" id="loadingLabel" visible="true"/>
				</mx:GridItem>
			</mx:GridRow>
		</mx:Grid>
		<mx:TileList
			width="100%" height="100%"
			borderStyle="inset"
			dragEnabled="true"
			backgroundColor="#EEEEEE"
			dataProvider="{twitterDataList}"
			itemRenderer="socialfaceicon.view.friendslist.FriendsListIcon"
			dragStart="onDragStart()"
			dragComplete="onDragComplete()"
			
			 borderColor="#EEEEEE"/>
	</mx:VBox>
</mx:Canvas>
